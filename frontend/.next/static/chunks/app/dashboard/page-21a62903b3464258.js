(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4274:function(e,t,r){Promise.resolve().then(r.bind(r,1907))},1907:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var a=r(7437),s=r(2265),l=r(4033),n=r(4302);function o(e){let{children:t}=e,[r,o]=(0,s.useState)(null),i=(0,l.useRouter)(),{isAuthenticated:c,isLoading:d}=(0,n.a)();return((0,s.useEffect)(()=>{d||(c?o(!0):(o(!1),i.push("/login")))},[c,d,i]),null===r||d)?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-black",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white/30"})}):r?(0,a.jsx)(a.Fragment,{children:t}):null}function i(e){let{task:t,onToggle:r,onDelete:s,onEdit:l}=e;return(0,a.jsx)("li",{className:"px-4 py-4 ".concat(t.completed?"bg-white/5":"bg-black"),children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:t.completed,onChange:()=>r(t.id),className:"h-4 w-4"}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:t.completed?"line-through text-[#a1a1aa]":"text-white",children:t.title}),t.description&&(0,a.jsx)("p",{className:"text-sm text-[#a1a1aa]",children:t.description})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:l,className:"px-2 py-1 text-xs rounded border border-blue-500/30 text-blue-400 hover:bg-blue-900/30",children:"Edit"}),(0,a.jsx)("button",{onClick:s,className:"px-2 py-1 text-xs rounded border border-red-500/30 text-red-400 hover:bg-red-900/30",children:"Delete"})]})]})})}function c(e){let{userId:t,onSubmit:r,onCancel:l,initialData:n}=e,[o,i]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,h]=(0,s.useState)("");return(0,s.useEffect)(()=>{if(n){var e;i(n.title),d(null!==(e=n.description)&&void 0!==e?e:"")}},[n]),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!o.trim()){h("Title is required");return}if(o.length>255){h("Title must be 255 characters or less");return}if(c.length>1e3){h("Description must be 1000 characters or less");return}h(""),r({title:o.trim(),description:c.trim(),user_id:t})},className:"space-y-4",children:[u&&(0,a.jsx)("div",{className:"rounded-md bg-red-900/30 p-4 border border-red-800/50",children:(0,a.jsx)("h3",{className:"text-sm font-medium text-red-300",children:u})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-white",children:"Title *"}),(0,a.jsx)("input",{value:o,onChange:e=>i(e.target.value),className:"mt-1 block w-full rounded-md border border-white/20 bg-black p-2 text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-white",children:"Description"}),(0,a.jsx)("textarea",{rows:3,value:c,onChange:e=>d(e.target.value),className:"mt-1 block w-full rounded-md border border-white/20 bg-black p-2 text-white"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm text-[#a1a1aa] hover:bg-white/10 rounded",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm bg-white text-black rounded",children:n?"Update Task":"Add Task"})]})]})}var d=r(4829),u=r(2601);let h=u.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000",m=d.Z.create({baseURL:h,timeout:1e4,headers:{"Content-Type":"application/json"}});m.interceptors.request.use(e=>{let t=localStorage.getItem("jwt_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),m.interceptors.response.use(e=>e,e=>{var t,r;return((null===(t=e.response)||void 0===t?void 0:t.status)===401||(null===(r=e.response)||void 0===r?void 0:r.status)===403)&&(localStorage.removeItem("jwt_token"),window.location.href="/login"),Promise.reject(e)});let x=async()=>{try{var e;let t=await m.get("/signup/users/from-token/tasks");return null!==(e=t.data)&&void 0!==e?e:[]}catch(e){throw e}},p=async e=>{try{let t=await m.post("/signup/users/from-token/tasks",e);if(!t.data)throw Error("Task creation failed: no data returned");return t.data}catch(e){throw e}},b=async(e,t)=>{try{let r=await m.put("/signup/users/from-token/tasks/".concat(e),t);if(!r.data)throw Error("Task update failed: no data returned");return r.data}catch(e){throw e}},f=async e=>{try{return await m.delete("/signup/users/from-token/tasks/".concat(e)),!0}catch(e){throw e}},g=async(e,t)=>{try{let r=await m.patch("/signup/users/from-token/tasks/".concat(e,"/complete"),{completed:t});if(!r.data)throw Error("Task completion toggle failed: no data returned");return r.data}catch(e){throw e}},w=()=>{let[e,t]=(0,s.useState)([]),[r,a]=(0,s.useState)(!0),[l,n]=(0,s.useState)(null),o=e=>e.filter(e=>"object"==typeof e&&null!==e&&"id"in e&&"title"in e&&"completed"in e);(0,s.useEffect)(()=>{i()},[]);let i=async()=>{try{a(!0),n(null);let e=await x();t(Array.isArray(e)?o(e):[])}catch(e){n("Failed to fetch tasks"),console.error(e)}finally{a(!1)}},c=async e=>{var r;let a=-Date.now(),s={id:a,title:e.title,description:e.description,completed:null!==(r=e.completed)&&void 0!==r&&r,user_id:"temp",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};t(e=>[...e,s]);try{let r=await p(e),s=r.data;return s&&t(e=>e.map(e=>e.id===a?s:e)),s}catch(e){throw t(e=>e.filter(e=>e.id!==a)),n("Failed to create task"),console.error(e),e}},d=async(e,r)=>{if(!(e<0)){t(t=>t.map(t=>t.id===e?{...t,...r}:t));try{let a=await b(e,r),s=a.data;return s&&t(t=>t.map(t=>t.id===e?s:t)),s}catch(e){throw n("Failed to update task"),console.error(e),e}}},u=async r=>{let a=e.find(e=>e.id===r);if(a&&(t(e=>e.filter(e=>e.id!==r)),!(r<0)))try{await f(r)}catch(e){throw t(e=>[...e,a]),n("Failed to delete task"),console.error(e),e}},h=async r=>{let a=e.find(e=>e.id===r);if(a&&(t(e=>e.map(e=>e.id===r?{...e,completed:!e.completed}:e)),!(r<0)))try{let e=await g(r,!a.completed),s=e.data;return s&&t(e=>e.map(e=>e.id===r?s:e)),s}catch(e){throw t(e=>e.map(e=>e.id===r?{...e,completed:a.completed}:e)),n("Failed to toggle task completion"),console.error(e),e}};return{tasks:e,loading:r,error:l,fetchTasks:i,addTask:c,updateTaskById:d,removeTask:u,toggleCompletion:h}};function v(e){let{userId:t}=e,[r,l]=(0,s.useState)(!1),[n,o]=(0,s.useState)(null),{tasks:d,loading:u,error:h,addTask:m,updateTaskById:x,toggleCompletion:p,removeTask:b}=w();return u?(0,a.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white/30"})}):h?(0,a.jsxs)("div",{className:"bg-red-900/30 border border-red-800/50 text-red-300 px-4 py-3 rounded",children:[(0,a.jsx)("strong",{children:"Error:"})," ",h]}):(0,a.jsxs)("div",{className:"bg-black border border-white/10 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-5 border-b border-white/10 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"Your Tasks"}),(0,a.jsx)("button",{onClick:()=>{l(e=>!e),o(null)},className:"px-4 py-2 border border-white/20 bg-white/10 hover:bg-white/20 text-white text-sm rounded",children:r?"Cancel":"Add Task"})]}),(r||n)&&(0,a.jsx)("div",{className:"px-4 py-5 border-b border-white/10",children:(0,a.jsx)(c,{userId:t,initialData:null!=n?n:void 0,onSubmit:async e=>{n?(await x(n.id,e),o(null)):(await m(e),l(!1))},onCancel:()=>{l(!1),o(null)}})}),0===d.length?(0,a.jsx)("div",{className:"text-center py-10 text-[#a1a1aa]",children:"No tasks yet. Add one!"}):(0,a.jsx)("ul",{className:"divide-y divide-white/10",children:d.map(e=>(0,a.jsx)(i,{task:e,onToggle:p,onDelete:()=>b(e.id),onEdit:()=>{o(e),l(!1)}},e.id))})]})}function j(){let e=(0,l.useRouter)(),{user:t,isAuthenticated:r,isLoading:i,logout:c}=(0,n.a)();return((0,s.useEffect)(()=>{i||r||(e.push("/login"),localStorage.removeItem("jwt_token"),localStorage.removeItem("auth_user"),e.replace("/login"))},[r,i,e]),i)?(0,a.jsxs)("div",{className:"min-h-screen bg-black flex flex-col",children:[(0,a.jsxs)("nav",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-white",children:"Todo App"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"text-[#a1a1aa]",children:"Loading..."}),(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-white/30"})]})]}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-grow",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white/30"})})]}):r?(0,a.jsx)(o,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-black flex flex-col",children:[(0,a.jsxs)("nav",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-white",children:"Todo App"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-[#a1a1aa]",children:["Welcome, ",null==t?void 0:t.username]}),(0,a.jsx)("button",{onClick:async()=>{await c(),e.push("/login")},className:"text-[#a1a1aa] hover:text-white border border-white/20 bg-transparent hover:bg-white/10 transition-colors duration-200 px-4 py-2 rounded-md",children:"Logout"})]})]}),(0,a.jsx)("main",{className:"flex-grow p-6",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white mb-8",children:"Task Dashboard"}),(0,a.jsx)(v,{userId:(null==t?void 0:t.id)||""})]})})]})}):null}},4302:function(e,t,r){"use strict";r.d(t,{a:function(){return d}});var a=r(2265),s=r(4829),l=r(2601);let n=l.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000",o="auth_user",i="jwt_token",c={login:async(e,t)=>{try{let r=await s.Z.post("".concat(n,"/auth/login"),{email:e,password:t},{headers:{"Content-Type":"application/json"}}),{user:a,token:l}=r.data;return localStorage.setItem(i,l),localStorage.setItem(o,JSON.stringify(a)),{user:a,token:l}}catch(e){if(s.Z.isAxiosError(e)){var r,a;throw Error((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"Login failed")}throw e}},signup:async(e,t,r)=>{try{let a=await s.Z.post("".concat(n,"/auth/signup"),{username:r,email:e,password:t},{headers:{"Content-Type":"application/json"}}),{user:l,token:c}=a.data;return localStorage.setItem(i,c),localStorage.setItem(o,JSON.stringify(l)),{user:l,token:c}}catch(e){if(s.Z.isAxiosError(e)){var a,l;throw Error((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.message)||"Signup failed")}throw e}},logout:async()=>(localStorage.removeItem(i),localStorage.removeItem(o),{message:"Successfully logged out"}),getCurrentSession:async()=>{let e=localStorage.getItem(i),t=localStorage.getItem(o);if(!e||!t)return null;try{return{token:e,user:JSON.parse(t)}}catch(e){return localStorage.removeItem(i),localStorage.removeItem(o),null}},isAuthenticated:()=>!!localStorage.getItem(i)},d=()=>{let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(!1),[l,n]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=async()=>{try{let e=await c.getCurrentSession();e?(t(e.user),s(!0)):(t(null),s(!1))}catch(e){console.error("Error checking auth status:",e),t(null),s(!1)}finally{n(!1)}};e()},[]);let o=async(e,r)=>{try{let a=await c.login(e,r);return t(a.user),s(!0),a}catch(e){throw e}},i=async(e,r,a)=>{try{let l=await c.signup(e,r,a);return t(l.user),s(!0),l}catch(e){throw e}},d=async()=>{try{await c.logout(),t(null),s(!1)}catch(e){console.error("Error during logout:",e)}};return{user:e,isAuthenticated:r,isLoading:l,login:o,signup:i,logout:d}}}},function(e){e.O(0,[600,971,472,744],function(){return e(e.s=4274)}),_N_E=e.O()}]);